# telemt-admin

**telemt-admin** ‚Äî —ç—Ç–æ Telegram-–±–æ—Ç –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏ [telemt](https://github.com/telemt/telemt) (MTProto –ø—Ä–æ–∫—Å–∏-—Å–µ—Ä–≤–µ—Ä–∞). –ü—Ä–æ–µ–∫—Ç —Å–æ–∑–¥–∞–Ω –¥–ª—è —Å–∏—Å—Ç–µ–º–Ω—ã—Ö –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤, –∫–æ—Ç–æ—Ä—ã–º –Ω—É–∂–Ω–æ –¥–µ–ª–µ–≥–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ—Ü–µ—Å—Å –≤—ã–¥–∞—á–∏ –¥–æ—Å—Ç—É–ø–∞, –∏–∑–±–∞–≤–∏–≤—à–∏—Å—å –æ—Ç —Ä—É—á–Ω–æ–≥–æ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤.

## –ó–∞—á–µ–º —ç—Ç–æ –Ω—É–∂–Ω–æ?

–¢—Ä–∞–¥–∏—Ü–∏–æ–Ω–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏ –≤ `telemt` —Ç—Ä–µ–±—É–µ—Ç –ø—Ä—è–º–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞ –∫ —Å–µ—Ä–≤–µ—Ä—É –∏ —Ä—É—á–Ω–æ–≥–æ –∏–∑–º–µ–Ω–µ–Ω–∏—è `/etc/telemt.toml`.
**telemt-admin** –ø–µ—Ä–µ–Ω–æ—Å–∏—Ç —ç—Ç–æ—Ç –ø—Ä–æ—Ü–µ—Å—Å –≤ Telegram:

- **–î–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π:** –ø—Ä–æ—Å—Ç–∞—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —á–µ—Ä–µ–∑ –±–æ—Ç–∞ –æ–¥–Ω–æ–π –∫–æ–º–∞–Ω–¥–æ–π `/start`.
- **–î–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤:** –º–≥–Ω–æ–≤–µ–Ω–Ω—ã–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –Ω–æ–≤—ã—Ö –∑–∞—è–≤–∫–∞—Ö –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥–æ—Å—Ç—É–ø–æ–º —á–µ—Ä–µ–∑ –∫–Ω–æ–ø–∫–∏ (Approve/Reject) –∏–ª–∏ –∫–æ–º–∞–Ω–¥—ã.
- **–î–ª—è —Å–µ—Ä–≤–µ—Ä–∞:** –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫ —Å–µ—Ä–≤–∏—Å–∞ –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏.

## ‚ö°Ô∏è –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç (Linux)

–°–∞–º—ã–π –±—ã—Å—Ç—Ä—ã–π —Å–ø–æ—Å–æ–± —Ä–∞–∑–≤–µ—Ä–Ω—É—Ç—å –±–æ—Ç–∞ ‚Äî –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≥–æ—Ç–æ–≤—ã–π –±–∏–Ω–∞—Ä–Ω—ã–π —Ñ–∞–π–ª.

### 1. –°–∫–∞—á–∏–≤–∞–Ω–∏–µ –∞–∫—Ç—É–∞–ª—å–Ω–æ–π –≤–µ—Ä—Å–∏–∏

–û–¥–Ω–æ–π –∫–æ–º–∞–Ω–¥–æ–π —Å–∫–∞—á–∞–π—Ç–µ –ø–æ—Å–ª–µ–¥–Ω–∏–π —Å—Ç–∞–±–∏–ª—å–Ω—ã–π —Ä–µ–ª–∏–∑ –¥–ª—è Linux x86_64:

```bash
curl -L -o telemt-admin.tar.gz https://github.com/fgbm/telemt-admin/releases/latest/download/telemt-admin-linux-x86_64.tar.gz && tar -xzf telemt-admin.tar.gz
```

### 2. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –±–∏–Ω–∞—Ä–Ω–æ–≥–æ —Ñ–∞–π–ª–∞

```bash
sudo mv telemt-admin /usr/local/bin/
sudo chmod +x /usr/local/bin/telemt-admin
```

### 3. –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

–°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `/etc/telemt-admin.toml`:

```toml
bot_token = "–í–ê–®_–¢–û–ö–ï–ù_–ë–û–¢–ê"
admin_ids = [123456789] # –í–∞—à Telegram ID
telemt_config_path = "/etc/telemt.toml"
db_path = "/var/lib/telemt-admin/state.db"
service_name = "telemt.service"
```

## üõ† –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∫–∞–∫ —Å–∏—Å—Ç–µ–º–Ω–æ–≥–æ —Å–µ—Ä–≤–∏—Å–∞

–î–ª—è –Ω–∞–¥–µ–∂–Ω–æ–π —Ä–∞–±–æ—Ç—ã –≤ —Ñ–æ–Ω–æ–≤–æ–º —Ä–µ–∂–∏–º–µ –Ω–∞—Å—Ç—Ä–æ–π—Ç–µ `systemd`:

1. **–°–æ–∑–¥–∞–π—Ç–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏:**

```bash
sudo useradd --system --home /var/lib/telemt-admin --shell /usr/sbin/nologin telemt-admin
sudo mkdir -p /var/lib/telemt-admin
sudo chown -R telemt-admin:telemt-admin /var/lib/telemt-admin
```

1. **–°–æ–∑–¥–∞–π—Ç–µ unit-—Ñ–∞–π–ª `/etc/systemd/system/telemt-admin.service`:**

```ini
[Unit]
Description=telemt-admin Telegram Bot Service
After=network-online.target

[Service]
Type=simple
User=telemt-admin
Group=telemt-admin
WorkingDirectory=/var/lib/telemt-admin
ExecStart=/usr/local/bin/telemt-admin /etc/telemt-admin.toml
Restart=always
RestartSec=5
Environment=RUST_LOG=info

[Install]
WantedBy=multi-user.target
```

1. **–ù–∞—Å—Ç—Ä–æ–π—Ç–µ –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞:**

–ß—Ç–æ–±—ã —Å–µ—Ä–≤–∏—Å –º–æ–≥ —É–ø—Ä–∞–≤–ª—è—Ç—å `telemt` –∏ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –µ–≥–æ –∫–æ–Ω—Ñ–∏–≥ –±–µ–∑ –ø—Ä–∞–≤ root:

**–ê. –†–∞–∑—Ä–µ—à–∏—Ç–µ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫ —Å–µ—Ä–≤–∏—Å–∞ —á–µ—Ä–µ–∑ Polkit:**

–°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `/etc/polkit-1/rules.d/50-telemt-admin.rules`:

```javascript
polkit.addRule(function(action, subject) {
    if (action.id == "org.freedesktop.systemd1.manage-units" &&
        action.lookup("unit") == "telemt.service" &&
        subject.user == "telemt-admin") {
        return polkit.Result.YES;
    }
});
```

**–ë. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –ø—Ä–∞–≤–∞ –Ω–∞ –∫–æ–Ω—Ñ–∏–≥ telemt:**

```bash
# –°–æ–∑–¥–∞–µ–º –≥—Ä—É–ø–ø—É telemt –µ—Å–ª–∏ –µ—ë –Ω–µ—Ç
sudo groupadd -f telemt

# –î–æ–±–∞–≤–ª—è–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –±–æ—Ç–∞ –≤ –≥—Ä—É–ø–ø—É
sudo usermod -aG telemt telemt-admin

# –ú–µ–Ω—è–µ–º –≥—Ä—É–ø–ø—É –≤–ª–∞–¥–µ–ª—å—Ü–∞ –∫–æ–Ω—Ñ–∏–≥–∞ –∏ –¥–∞–µ–º –ø—Ä–∞–≤–∞ –Ω–∞ –∑–∞–ø–∏—Å—å –≥—Ä—É–ø–ø–µ
sudo chown :telemt /etc/telemt.toml
sudo chmod 664 /etc/telemt.toml
```

1. **–ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å–µ—Ä–≤–∏—Å:**

```bash
sudo systemctl daemon-reload
sudo systemctl enable --now telemt-admin.service
```

## üìã –ö–∞–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è

### –î–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

1. –ù–∞–π—Ç–∏ –±–æ—Ç–∞ –∏ –Ω–∞–∂–∞—Ç—å `/start`.
2. –ü–æ—Å–ª–µ —Å—Ç–∞—Ä—Ç–∞ –ø–æ—è–≤–ª—è–µ—Ç—Å—è –ø–æ—Å—Ç–æ—è–Ω–Ω–æ–µ –º–µ–Ω—é:
   - `üîó –ú–æ—è —Å—Å—ã–ª–∫–∞` ‚Äî –ø–æ–ª—É—á–∏—Ç—å —Å—Å—ã–ª–∫—É –ø–æ–≤—Ç–æ—Ä–Ω–æ.
   - `‚ùì –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è` ‚Äî –∫—Ä–∞—Ç–∫–∞—è –ø–∞–º—è—Ç–∫–∞ –ø–æ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—é.
3. –î–æ–∂–¥–∞—Ç—å—Å—è –æ–¥–æ–±—Ä–µ–Ω–∏—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–º.
4. –ü–æ—Å–ª–µ –æ–¥–æ–±—Ä–µ–Ω–∏—è –±–æ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏—à–ª–µ—Ç —Å—Å—ã–ª–∫—É –¥–ª—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –ø—Ä–æ–∫—Å–∏.

### –î–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤

–ü—Ä–∏ –ø–æ—Å—Ç—É–ø–ª–µ–Ω–∏–∏ –Ω–æ–≤–æ–π –∑–∞—è–≤–∫–∏ –≤—ã –ø–æ–ª—É—á–∏—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ —Å –¥–∞–Ω–Ω—ã–º–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏ –¥–≤—É–º—è –∫–Ω–æ–ø–∫–∞–º–∏:

- **‚úÖ –û–¥–æ–±—Ä–∏—Ç—å**: –±–æ—Ç —Å–≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç —Å–µ–∫—Ä–µ—Ç, –¥–æ–±–∞–≤–∏—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ –∫–æ–Ω—Ñ–∏–≥ `telemt` –∏ –æ—Ç–ø—Ä–∞–≤–∏—Ç –µ–º—É —Å—Å—ã–ª–∫—É.
- **‚ùå –û—Ç–∫–ª–æ–Ω–∏—Ç—å**: –∑–∞—è–≤–∫–∞ –±—É–¥–µ—Ç –ø–æ–º–µ—á–µ–Ω–∞ –∫–∞–∫ –æ—Ç–∫–ª–æ–Ω–µ–Ω–Ω–∞—è, –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–æ–ª—É—á–∏—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ.

–¢–∞–∫–∂–µ –ø–æ—Å–ª–µ `/start` –¥–æ—Å—Ç—É–ø–Ω–æ –ø–æ—Å—Ç–æ—è–Ω–Ω–æ–µ –∞–¥–º–∏–Ω-–º–µ–Ω—é:

- `üì• –ù–æ–≤—ã–µ –∑–∞—è–≤–∫–∏` ‚Äî –ø–æ–∫–∞–∑–∞—Ç—å –∞–∫—Ç—É–∞–ª—å–Ω—ã–µ pending-–∑–∞—è–≤–∫–∏ —Å –∫–Ω–æ–ø–∫–∞–º–∏ approve/reject.
- `üë• –°–ø–∏—Å–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π` ‚Äî –ø–æ–∫–∞–∑–∞—Ç—å –∞–∫—Ç–∏–≤–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Å inline-–∫–Ω–æ–ø–∫–æ–π —É–¥–∞–ª–µ–Ω–∏—è.
- `‚öôÔ∏è –°—Ç–∞—Ç—É—Å —Å–µ—Ä–≤–∏—Å–∞` ‚Äî –ø–∞–Ω–µ–ª—å —Å—Ç–∞—Ç—É—Å–∞ `telemt` —Å –∫–Ω–æ–ø–∫–∞–º–∏ `–û–±–Ω–æ–≤–∏—Ç—å`, `–†–µ—Å—Ç–∞—Ä—Ç`, `–ü–µ—Ä–µ—á–∏—Ç–∞—Ç—å –∫–æ–Ω—Ñ–∏–≥`.
- `üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞` ‚Äî –æ–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø–∏—Å–µ–π –∏ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ —Å—Ç–∞—Ç—É—Å–∞–º.

**–û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞:**

- `/approve <id>` / `/reject <id>` ‚Äî —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∑–∞—è–≤–∫–∞–º–∏ –ø–æ ID.
- `/create <tg_user_id>` ‚Äî —Å–æ–∑–¥–∞—Ç—å –æ–¥–æ–±—Ä–µ–Ω–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –±–µ–∑ –∑–∞—è–≤–∫–∏.
- `/delete <tg_user_id>` ‚Äî —É–¥–∞–ª–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–∑ —Å–∏—Å—Ç–µ–º—ã –∏ –∫–æ–Ω—Ñ–∏–≥–∞.
- `/service status` ‚Äî –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏–µ –æ—Å–Ω–æ–≤–Ω–æ–≥–æ —Å–µ—Ä–≤–∏—Å–∞ `telemt`.
- `/service restart` ‚Äî –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å –ø—Ä–æ–∫—Å–∏.
- `/service reload` ‚Äî –ø–µ—Ä–µ—á–∏—Ç–∞—Ç—å –∫–æ–Ω—Ñ–∏–≥ —Å–µ—Ä–≤–∏—Å–∞ –±–µ–∑ –ø–æ–ª–Ω–æ–≥–æ —Ä–µ—Å—Ç–∞—Ä—Ç–∞ (–µ—Å–ª–∏ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è unit-—Ñ–∞–π–ª–æ–º).

## ‚öôÔ∏è –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è (telemt-admin.toml)

| –ü–∞—Ä–∞–º–µ—Ç—Ä             | –û–ø–∏—Å–∞–Ω–∏–µ                                                                |
| :------------------- | :---------------------------------------------------------------------- |
| `bot_token`          | –¢–æ–∫–µ–Ω –±–æ—Ç–∞ –æ—Ç @BotFather (–º–æ–∂–Ω–æ –ø–µ—Ä–µ–¥–∞—Ç—å —á–µ—Ä–µ–∑ `TELOXIDE_TOKEN`).       |
| `admin_ids`          | –°–ø–∏—Å–æ–∫ —á–∏—Å–ª–æ–≤—ã—Ö ID –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤ Telegram.                            |
| `telemt_config_path` | –ü—É—Ç—å –∫ –æ—Å–Ω–æ–≤–Ω–æ–º—É –∫–æ–Ω—Ñ–∏–≥—É `telemt.toml`. –î–æ–ª–∂–µ–Ω –±—ã—Ç—å –¥–æ—Å—Ç—É–ø–µ–Ω –Ω–∞ –∑–∞–ø–∏—Å—å. |
| `db_path`            | –ü—É—Ç—å –∫ SQLite –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –∑–∞—è–≤–æ–∫ –∏ —Å–æ—Å—Ç–æ—è–Ω–∏–π.              |
| `service_name`       | –ò–º—è —Å–∏—Å—Ç–µ–º–Ω–æ–≥–æ —Å–µ—Ä–≤–∏—Å–∞ –ø—Ä–æ–∫—Å–∏ –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —á–µ—Ä–µ–∑ `/service`.          |

## üîÑ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ

–î–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –¥–æ –ø–æ—Å–ª–µ–¥–Ω–µ–π –≤–µ—Ä—Å–∏–∏ –ø—Ä–æ—Å—Ç–æ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ –∫–æ–º–∞–Ω–¥—É –∏–∑ —Ä–∞–∑–¥–µ–ª–∞ "–ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç" –∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ —Å–µ—Ä–≤–∏—Å:

```bash
sudo systemctl restart telemt-admin.service
```

## üèó –°–±–æ—Ä–∫–∞ –∏–∑ –∏—Å—Ö–æ–¥–Ω–∏–∫–æ–≤

–ï—Å–ª–∏ –≤—ã —Ö–æ—Ç–∏—Ç–µ —Å–æ–±—Ä–∞—Ç—å –±–æ—Ç–∞ —Å–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω–æ:

1. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ Rust (Edition 2024).
2. –í—ã–ø–æ–ª–Ω–∏—Ç–µ —Å–±–æ—Ä–∫—É: `cargo build --release`.
3. –ë–∏–Ω–∞—Ä–Ω—ã–π —Ñ–∞–π–ª –±—É–¥–µ—Ç –Ω–∞—Ö–æ–¥–∏—Ç—å—Å—è –≤ `target/release/telemt-admin`.

## CI/CD

–ü—Ä–æ–µ–∫—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç GitHub Actions –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏ –∫–æ–¥–∞ (`clippy`, `check`) –∏ —Å–±–æ—Ä–∫–∏ —Ä–µ–ª–∏–∑–æ–≤ –ø–æ–¥ Linux –∏ Windows –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ —Ç–µ–≥–∞ –≤–µ—Ä—Å–∏–∏ (`vX.Y.Z`).
